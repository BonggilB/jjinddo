[근태관리]
--------------------
aspx자바스크립트 히든페이지값에 pg를 넣고 공수변경신청시 호출되는함수이다.
페이지 최초 로드시

연월일 - 지금 연월일
히든페이지.밸류 - 1
페이지 넘버 - 히든페이지 밸류(윗줄)
오더타입.밸류 - 0

텍스트검색날(?) - 지금 연월일
페이지사이즈 - 100
페이지사이즈옵션의선택된값 - 페이지사이즈
--처음로드시엔 지금날짜와 입력한 값(윗줄들)으로 페이지 설정을 해줌(나중에 클라이언트가 조정하는 밸류값에 따라 표시내용이바뀜)

로그인시 ds 0번째 테이블에서 가져와 폼안에 저장했던 ID를 가져온다 데이터안에 Auth값에따라 표시되는 컨텐츠랑 디자인이 바뀜 
FA 현장관리자
	현장목록을 비활성화
	콜럼1,2 간격 재조정
AM 관리자
	공수변경신청내역 활성화
	공수변경신청버튼 제거
	스타일조정
M 마이즈계정
	공수변경신청내역 활성화
	스타일 조정

현장불러오고
사이트에 뿌릴 데이터를 가져온다

까지가 페이지 로드시 작동될것들><

-----------------------------------
ddlSiteBind()
DB접속하고 DS안에 건설사 삭제여부가 N인 현장들을 모두 불러와 dl(드롭다운리스트)안에 넣어주는데
이때 사이트구분은 '선택'이다 헷갈리면 안되는게 현장리스트를 현장관리자여도 싹다 불러온다 (!)
(미래의 나 -
다불러오지만 현재 현장관리자면 현장목록 비활성화가 된 상태다 그럼 현장관리자의 
사이트구분을 어디서 가져오느냐가 문제인데 나중에 GetDataFromDB 안에있는 프로시저에서
IF문을통해 어드민ID에따라 사이트구분에 현장명을 넣어버려서 현장관리자는 자기현장명이 들어간다 ㅎㅎ)

표시할땐 활성화여부에따라 배경색이바뀐다

----------------------------------
GetDataFromDB() 우선출력테이블 2 개 OUTPUT 레코드카운트
파라미터안에 페이지,페이지사이즈,연,월,일,검색대상,검색어,정렬방법,어드민ID,현장명 을넣어서

일간근태현황_p 를 호출한다.
	1.불러올데이터의 시작과 끝을 페이지와,페이지 사이즈값으로 구한다.

	2.우리가 넣은 ID값에 따라 사용자가 무슨 권한을 가지고 있는지 @Auth값 안에 넣어준다.
	처음 ddlsite값이 '선택' 으로 들어가는데 @Auth 값에 따라 현장관리자는 IF문을타서 @사이트구분에 각현장명으로 들어간다.
	고로 관리자계정은 ddlsite값이 '선택'이다 (나중에 드롭다운 리스트에서 선택하면 해당현장명이 들어가게된다.)

	3.프로시저에서 반환받기로한 @레코드개수값은 일간과 팀별 테이블 에서 해당날짜의 직종과 현장이 일치하는것을 합쳐주어 세는것뿐이다.
	이값은 총인원수에 해당한다 발표할땐 총 인원수라고 하자
	근데 문제는 이걸 쓰는게 Tmp로 다묶어버린다음 From절에서 사용하는방법인데 바로 아래에 적혀있다 맛집이니 다시한번 잘 보자.

-----------쓸부분------------------
	4.데이터 불러오는과정
	우리가 넣은 @날짜와 @검색조건 @검색어 등이 일치하고 @현장명 이 일치하는 일간근태현황 데이터에서
	Left Join으로 직종,현장,날짜가같다면 일간팀별현황을 합치고
	조건이같은 공수변경신청리스트 데이터도 추가해준다.
	RowNo는 @정렬기준에 따라 데이터가 몇번째인지 세고
	@총인원에서 RowNO를 빼서 그사람의 번호를 구해준다(총 600명 출근한날 50번째 출근한사람은 600-550+1)
	일간근태현황에 RowNo를 추가하고 주민등록번호나,공수변경신청내역,팀공수변경신청내역,팀원수,현장명을 붙여준다

-------------------------------------
프로시저에서 빠져나오면
OUTPUT 데이터를 레코드 카운트에 넣어주고->레코드 카운트가 있다 ? 데이터표시활성화,페이징관련된함수들 : 없으면 데이터없음표시->
정렬관련된 내용->총인원수 표시와 ->현장명 불러오기(현장비활성화일시 배경색 변경)후
테이블[0](일간근태테이블에 기타정보를합친것)을 리피터에 넣어주고 불러오기 해준다.

리피터는 for문처럼 자동으로 돌아준다.
ID rptList를통해 데이터바운드가 호출되면

테이블 ID에 따라 라벨을 먼저 지정해주고
이벤트에 담겨온 데이터소스에서 괄호안의 내용들을 찾은다음 뿌려주게되는데

사용자이름엔 해당사용자정보가담긴 달력페이지로 이동할수있게 링크주소를 데이터에서 불러와GET방식으로 넣어준다.
기 타 등 등 불 러 오 다 가
근무시간은 60으로 나눈값 , 분은 60으로 나눈값의 나머지를구해 시:분을 구한다. 나중에 또 계산하지말자
어드민 계정일경우 공수변경신청과 신청내역버튼을 비활성화
공수변경신청승인상태가
	I일경우 신청중
	Y일경우 공수변경승인완료 인것과 팀별공수변경신청상태에 따라 표시내용이 달라진다.

리피터 아이템커맨드는 메모나 퇴근시간수정이가능하지만 rptList_ItemCommand
수정된데이터가 없는걸봤을때 사용하지않는기능같음

--------------------------------------
엑셀다운로드를 누르면
일간근태리스트_p로 진입해
	현장관리자라면 해당현장의
	검색을했을경우 그조건의 일간데이터를 dv로뽑아 
ExcelDownload함수안에 파일명과 데이터를 넣어 문서 형식을지정하고 데이터를넣어 엑셀로 다운받는다.

---------------------------------------
공수변경신청버튼 (btnRequest)을 누를시
리피터뿌릴때 지정한 해당 테이블데이터가 자바스크립트 RequestAdd 함수를통해 전달되고
RequestAdd(ID,이름,현장,날짜){
	히든밸류값에 ID저장;
	히든밸류값에 성함저장;
	히든밸류값에 현장저장;
	히든밸류값에 신청날짜저장;   -----------프로시저에 사용할 값

	팝업 성함값에 성함저장;
	팝업 현장값에 현장저장;
	팝업 메모값에 메모저장;  
	팝업 날짜값에 날짜저장;  -----------팝업에 표시할내용 & 프로시저에 사용할값

	어드민팝업 표시;
}
공수는 기본0임
신청버튼을 누르면 신청사유가있는지확인하고
btnSave_Click()함수로 넘어간다
넘어온값을 파라미터에 연월, 일, 현장명, 사용자ID, 성함, 메모내용, 신청날짜를 담아
신청목록추가_p를 호출한다
	공수변경 신청목록 테이블에 파라미터값을넣어주는데 GETDATE로 신청이된 순간의 날짜도 담아준다,신청상태를I로 등록해준다.
	일간근태 테이블에서의 해당사용자의 신청날짜에맞는 공수변경신청상태도 I로 해준다.
	좋다><

일간근태현황(팀별)---------------------------------------

goList : 페이징 함수
RequestAdd : 공수변경팝업 표시함수(아직 팀원목록을 DB에서 안불러와서 한번더 돌려야됨)
RequestAdd2 : 상반의 이유로인해 다시한번돌려서 팀원을 표시해주는 함수
ViewDel - 팝업닫기
Check - 공수변경 신청을 누르면 체크된팀원이 있는지 확인하고 신청사유를 입력했는지 확인하는 함수
setCheckbox - 전체선택,해제할때 사용하는 함수 (처음엔 체크된사람들 공수변경신청할때 쓰는건줄)
setArrayMemberUserId - 요놈이 누가체크된지 알아오는함수


데이터는 데몬에서 도어로그보내주기전 파일업로드구문에서 @Cust 가상테이블안에 사용자정보를담아서 만들었던 일간팀별근태현황에서 가져왔다.
(팀원수는 insert할때 일간근태에서 Company를 Count해서 만들어쑴ㅎㅅㅎ)
테이블구조만다른 팀별일간근태현황 테이블에서 데이터를 가져온다.
특이한건 공수변경 신청할때 해당팀의 팀원정보를 리피터로 받아온다는것
공수변경 신청을하면 체크박스에체크가 됐고 사유가있는지 확인후 공수변경신청을 해준다

Get팀슈프리마정보 함수는 안쓴다(버튼팝업클릭이벤트 리스너가 비활성화돼있음)    --이게 맞는지 여쭤보자


주간근태현황-------------------------------------------------

특이한점은 두개가있는데
날짜를구할때 월요일과 일요일기준에서 6일을 빼주고 더해준다. (월요일이면 더해주고 일요일이면 빼줌)
					(달력에 일일이 시작하고 끝나는날과 해당달의 총날짜수를 적는걸 이거로 만들수있을거같다. 
					시작날 = currYearMonth.Text +"01",  끝날 = 시작날.AddMonths(1).AddDays(-1)
					각 시작날,끝날 월화수목금토일에따라 Start,End값 0,1,2,3,4,5,6 으로하고 차이만큼 달력일수로하거나 DaysInMonth로
					나중에 심심할때 해보자)
이렇게 구해진 시작날짜와 끝날짜로 겟데이터DB호출시 그사이에있는 일간근태데이터를 그룹으로 묶어준다.
52시간 초과근무자 보기 체크시 @52_Check가='Y'로 돼서
 겟데이터DB할때 시작날과 끝날자안의 일간근태 근무시간의 총합이 52시간이 넘는사람들만 불러온다.


월간근태현황--------------------------------------------------
월간동기화 데몬프로시저로 원천테이블에서 가상@CUST테이블에 담아서 만들었던 working_month_info테이블에서 조건에맞는 사용자목록을가져와
리피터로 뿌려준다.
어..그렇다

월간집계표------------------------------------------------------
월간통계_p
	우리가 페이지에서보낸 연월=그달 , 프로시저안에 그달에해당되는모든날 = 그날
	그날 @CUST테이블에 각종정보를담아서

	그날 해당근로자가 해당날짜에 어떤직종으로 근무했는지,

	그날 성함,주민등록번호(이해하기쉽게 일단 이렇게 적어놓자)
	
	그날 공수

	공수수정내용

	출근시간,퇴근시간,근무시간이

	데이터의총숫자(RowNo)에서 우리가 페이징설정한값만큼 데이터를 가져옴

공수변경신청내역 ----------------------------------------------
이벤트리스너(윈도우실행시, 함수(){
	var list_cnt = 히든pazeSize 밸류값 10
	tmpChkCnt = 페이지에 만들어진 체크박스의갯수
	
	조건문으로 체크박스가 존재한다면
	반복문을 돌려서
	삭제여부Y인 체크박스를 비활성화해준다.
})
setCheckbox(){
	전체선택,해제할때 쓰는건데
	중간에 삭제돼서 비활성화돼있는애들은 체크를안해준다.
}

공수신청리스트_p

	해당월의 상태가 D가아닌 모든공수신청내역을 다 불러온다.(D는 삭제된 신청내역)

	공수신청목록T와 일간근태T의 해당월의 공수신청내역과 근태정보를 합쳐서
	공수신청목록으로 보여주기위한 데이터를 가져와 

리피터로 뿌려준다.

공수변경신청내역(팀)---------------------------------------------
체크박스 비활성화여부 함수

인원수 누르면 팀원이름 나오는 함수

체크박스 누를때마다 호출되는 함수 setArrayRequest ID(obj){
	체크할시 체크버튼을 누른 리피터데이터가 몇번인지 잘라서 가져온다.("밍구밍구_0" 이면 "밍구밍구_"을 ""로 Replace해서 0만 가져옴)
	그렇게 저장한값으로 DB_ID와 공수를담고
	어레이 형태로 값을 넣어 히든밸류값에 어레이형태로 저장해 준다.
}

팀별 공수변경신청 목록_p에서 조건이 직종인것과 테이블이 팀별공수신청목록인것만 빼면 비슷한 동작으로 동작한다.


[노임대장]
노임대장리스트-------------------------------------------

페이지로드 - 오늘의연도만

현장명불러오기

겟데이터DB(){
	노임대장리스트_P안에 연도를넣어서
		현재시간전의 노임대장리스트를 불러온다.
}

현장확인( 사이트이름 ){해당현장이 존재하는지 확인해준다.
	프로시저를통해 현장목록에서 @Site_gubun이 존재하는지 확인해준다.
}

라운드다운( α, β ){ 각종계산할때 사용되는함수
	α * (10의 β 제곱) 을 (10의 β 제곱)으로 나눠준다... 아래 계산식은 이런게있구나 하고 넘기기
}

파서더블( 값 ){ 값에 , 을빼줌 }

직종가져오기( 사이트이름, 연월 ){ 엑셀다운로드시 해당월의 모든직종을 가져오는데 사용된다.
	노임대장직종가져오기_p
		노임대장수정T 에서 해당연월에 1일부터31일까지 직종들을 중복제거해 합쳐준다음 정렬해서 불러온다.
}

엑셀다운로드 ( 파일명, 연월, 현장명 ){  직종을 먼저 가져와서
	1.직종들을 배열안에 담아준다.
	2.직종안에 있는사람 목록을 뽑으면
	3.한사람마다 1~31일까지 공수가있고 여러 계산을해서 소계를내게된다.
	한직종안의 모든사람들이 해당작업을 마치면 다시 1번으로 돌아간다.
}

노임대장 상세보기 --------------------------------
SetSite()를 통해 건설사의 현장명을 가져와
SetddlCompany() 로 1일부터31일까지 있었던 직종을 중복제거해 모두 가져온다.

노임대장 상세보기_p
	해당월, 현장, 직종에 있는사람들을 개인정보를추가하여 다 불러온다.
	수정된노임대장 테이블에서 1~31일까지 공수정보를 다 불러와
리피터로 뿌려준다
리피터에 안에 있는 아이템들을
for문돌려서 정수로 바꾼다음에 소계를 내준다


노임대장 19공 리스트 ---------------------------------공수가 19이상인사람들을 19공수초과되지않게 표시해준다.
moveView () { 보기버튼누를시 해당 View주소로 이동 }

노임대장 19공 상세보기---------------------------
checkDate(target) { 현재월보다 초과되는자료조회 불가능하게해줌 }
노임대장19공_p
	위와같은 정보를이용해 노임대장19공 사람들의 정보를 불러온다.

리피터로 데이터를 뿌려주는데
lblTotalWorkofDay에 총 일한공수가 들어가고
값이 18미만이면 원래대로 보여주고 19공수테이블에 공수가찍힌 날짜를 저장해준다.
18이상이라면
CreateRandomArray()를통해 (끝날자를 기준으로 sum이18(19개) 될때까지 계속돌려 19공수로 생성된다.)
31개의 빈 Array에 랜덤으로 19개의 1이 들어가게 된다

ChkNineteenData 로 이미 19공으로 수정된데이터가있을경우 가져와서 뿌려주고
없을경우 위에만든 랜덤Array를 뿌려준다.
그리고 새로고침할때마다 출근날이 랜덤하게 바뀌면안되니 해당 정보를
랜덤어레이입력_P를통해 19공수테이블로 넣어준다.

[공수변경신청 승인,반려등]
공수변경신청 상태변경시 생기는 일들 ------------------------
공수변경신청 상태변경시 해당리피터의 정보를
ddlStatusEdit_SelectedIndexChanged(){ UpdateStautsValue( 테이블ID, 공수값, 신청날(day_$$) 을 호출하고 새로고침 해준다. ) }

UpdateStautsValue( 테이블ID, 변경상태, 신청공수 ) ) {
	usp_admin_request_list_status_update_p 를 호출해준다
		(테이블ID)의값이 일치하는 공수신청목록에 공수신청 상태를 (변경상태)로 바꿔준다
		변경상태가 Y일경우 해당 (신청공수) 만큼 노임대장테이블에 해당사용자의 공수를 변경해준다.
		공수변경내역이있을경우 오늘날짜로 공수변경이됐다는 이력을 추가해주고
		내역이없을경우 오늘날짜로 공수변경이됐다는 이력을 만들어준다.
}

그렇게 변경된 공수신청내역은 노임대장에 표시될때 변경상태가 Y인것들은 노랗고 굵게 불러와진다.

[작업일보]
작업일보 리스트-------------------------------------------------------
얜왜 리피터가 네개일까
리피터 네갠데 0번째만씀 ^^
작업일보_p
	이번달이라면
	작업일보 목록을 선택한 달의 일자(day) 이전것만 불러온다.
	이번달이 아니라면
	과거의 달의 모든것을 불러온다.
리피터로 뿌려주고

엑셀다운로드시 연,월,사이트구분을 넣고
(아래에서 설명할내용) 일간근태정보보기_p를 호출해 나온 데이터를 엑셀안에 넣어준다.


작업일보 보기--------------------------------------------------------
setComma( 값 ) { 넘어온값의 소수점기준으로 분리해준다. }
removeComma ( 값 ) { 넘어온값의 ','를 없애준다.
isNumberKey ( 값, 인덱스 ) { 인덱스의 길이를 정해준다 }
charCode = 삭제버튼 입력을받으면 날려주는내용
장비현황체크하는데 사용하는 함수들( 인덱스번호만큼 저장 )

일간근태 정보보기_p
[여기설명할땐 디버깅찍어서 설명하는게 낫겠음 테이블이 너무많고 동작 코드가 반복적이며 김(앞에서 대부분 설명한내용)]
	해당현장의 자재나 장비 인력등의 정보를각각 테이블에서 셀렉트해준다.
	해당날짜 전까지의 SUM으로 합산한 합계쿼리도 있다.
	공수나 직종은 노임대장테이블에서 합쳐서
각 구문별로 계를구해 뿌려준다. (총계는 전일과 금일의 합산이다.)
